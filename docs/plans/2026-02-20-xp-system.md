# CharacterOS — XP & Character Evolution System

**Date:** 2026-02-20
**Status:** Canonical reference document

---

## Overview

CharacterOS uses an RPG-style XP system where real-world actions generate experience points that flow into 6 character stats. Stats drive character level, and level determines character evolution stage. The character type that emerges is determined by the unique combination of the user's dominant stats — reflecting who they actually are, not a choice they made.

---

## The 6 Stats

| Stat | Abbr | Color | Domain |
|---|---|---|---|
| Strength | STR | Red | Physical effort, exercise, sports, health |
| Intellect | INT | Blue | Learning, research, reading, coding, problem-solving |
| Discipline | DIS | Amber | Admin, deadlines, consistency, repetitive-but-necessary work |
| Charisma | CHA | Purple | Communication, writing, networking, sales, teaching, presenting |
| Creativity | CRE | Emerald | Design, art, building, brainstorming, music, storytelling |
| Spirituality | SPI | Indigo | Reflection, mindfulness, journaling, rest, meditation |

Each stat has its own independent XP pool stored in the `user` table (`strength_xp`, `intellect_xp`, etc.).

---

## How XP Is Earned

### Via Tasks (primary mechanism)

When a task is created, the AI classifier (`classifyTaskStats()`) assigns a **weight (0–5)** to each stat based on the task's content. These weights are stored on the task row.

When the task is marked **complete**, each stat receives:

```
xp_gained = stat_weight × difficulty_multiplier
```

**Difficulty multipliers:**

| Difficulty | Multiplier |
|---|---|
| Low | × 1 |
| Medium | × 2 |
| High | × 3 |

**Example:**
- Task: "Write a research paper on neural networks"
- AI assigns: INT: 4, DIS: 2, CRE: 1
- Difficulty: High (× 3)
- XP awarded: INT +12, DIS +6, CRE +3

**Minimum guarantee:** If all weights are 0 after AI classification (fallback failure), DIS receives +1 XP so completing any task always rewards something.

**XP reversal:** Un-completing a task does NOT subtract XP. XP is awarded once and is permanent.

### Via Logs (future mechanisms)
Future input types (journal entries, workout logs, session reflections) will award XP directly to relevant stats via the `logs` table. Not implemented in current batch.

---

## Stat Levels

Each stat has its own level derived from its XP pool:

```
stat_level = floor(stat_xp / 15) + 1
```

Displayed as "Lv.N" on the stat mini-cards. There is no cap.

---

## Character Level

Character level is derived from **total XP across all stats**:

```
character_level = floor(total_xp / 100) + 1

where total_xp = STR + INT + DIS + CHA + CRE + SPI
```

**Level milestones:**

| Level | Milestone |
|---|---|
| 1–4 | Egg stage (no character type yet) |
| 5 | **HATCH** — character type determined from top-2 stats |
| 15 | Evolution to Adult form |
| 30 | Evolution to Master form |

XP required to reach each milestone (at average 2 tasks/day × medium difficulty × weight 2):
- Level 5: ~400 total XP (~33 tasks)
- Level 15: ~1400 total XP (~117 tasks)
- Level 30: ~2900 total XP (~242 tasks)

---

## Character Type Determination

At **level 5**, the system reads the current XP values across all 6 stats and identifies the **top 2 dominant stats**. These determine the character type that the user hatches into.

The character type is stored in `user.character_type` and never automatically changes after hatch (the character evolves in stage, not type — reflecting that your core nature was shaped by how you played up to that point).

### Type Mapping

| Top 2 Stats | Character Type | Identity |
|---|---|---|
| STR dominant | Warrior | Physical mastery, raw effort |
| INT dominant | Scholar | Knowledge, analysis, systems |
| DIS dominant | Monk | Consistency, discipline, process |
| CHA dominant | Envoy | Influence, connection, leadership |
| CRE dominant | Artisan | Creation, expression, craft |
| SPI dominant | Mystic | Reflection, stillness, wisdom |
| STR + DIS | Soldier | Relentless execution under pressure |
| INT + CRE | Inventor | Building new things with deep thinking |
| CHA + CRE | Visionary | Inspiring ideas brought to life through storytelling |

All other stat pairs fall back to the single dominant type (whichever of the top 2 has higher XP).

### Algorithm

```typescript
function getCharacterType(stats: StatValues): CharacterType {
  const ranked = Object.entries(stats)
    .sort(([, a], [, b]) => b - a); // descending by XP

  const [first, second] = ranked;
  const firstStat = first[0];   // e.g. 'intellect'
  const secondStat = second[0]; // e.g. 'creativity'

  // Check special combos first
  if (isCombo(firstStat, secondStat, 'strength', 'discipline')) return 'soldier';
  if (isCombo(firstStat, secondStat, 'intellect', 'creativity')) return 'inventor';
  if (isCombo(firstStat, secondStat, 'charisma', 'creativity'))  return 'visionary';

  // Fall back to dominant stat
  const pureMap: Record<string, CharacterType> = {
    strength: 'warrior', intellect: 'scholar', discipline: 'monk',
    charisma: 'envoy',   creativity: 'artisan', spirituality: 'mystic',
  };
  return pureMap[firstStat];
}
```

A "special combo" only triggers if the secondary stat is within 20% of the primary stat's XP value — prevents edge cases where one stat vastly dominates and the secondary is trivially small.

---

## Character Evolution Stages

| Stage | Trigger | Image path |
|---|---|---|
| Egg | Levels 1–4 | `public/characters/egg.png` (universal) |
| Child | Level 5 (hatch) | `public/characters/{type}/child.png` |
| Adult | Level 15 | `public/characters/{type}/adult.png` |
| Master | Level 30 | `public/characters/{type}/master.png` |

**36 images required** (1 universal egg + 9 types × 3 stages).

The character image is displayed on the dashboard with:
- Character type name (e.g. "Inventor")
- Current stage label
- Progress to next stage (XP remaining / total needed)

---

## XP Progress Bar (Dashboard)

Displayed as a bar showing progress to the next character level:

```
xp_in_current_level = total_xp % 100
xp_progress_percent = (xp_in_current_level / 100) * 100
```

---

## Integrity (Phase 5 — not yet implemented)

High-value task completions (weight sum > 10, or difficulty = high) will eventually trigger a **reflection prompt**: "What did you learn from this?" before XP is awarded. This is the Integrity Engine from the original plan and will be implemented as a separate feature after the core XP + character system is stable.

---

## Future XP Sources (Planned)

| Source | Mechanism |
|---|---|
| Journal entries | NLP analysis of daily log → SPI, INT, CRE gains |
| Workout logs | Duration + intensity → STR, DIS gains |
| Reading logs | Pages read + reflection → INT gains |
| Streak bonuses | Consecutive daily task completions → DIS bonus |
| Level-up rewards | Flat XP bonus on milestone levels |
